<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ –ì—Ä–∞ –≤ –°–ª–æ–≤–∞ - Firebase Multiplayer Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 32px;
        }

        .header h1 {
            margin: 0;
            color: #2D3748;
            font-size: 2.5rem;
            font-weight: 800;
        }

        .header p {
            margin: 8px 0 0 0;
            color: #718096;
            font-size: 1.1rem;
        }

        .demo-section {
            margin: 24px 0;
            padding: 20px;
            background: #F7FAFC;
            border-radius: 12px;
            border-left: 4px solid #4299E1;
        }

        .demo-section h3 {
            margin: 0 0 12px 0;
            color: #2D3748;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin: 24px 0;
        }

        .feature {
            background: #EDF2F7;
            padding: 16px;
            border-radius: 8px;
            border-left: 3px solid #38B2AC;
        }

        .feature h4 {
            margin: 0 0 8px 0;
            color: #2D3748;
        }

        .feature p {
            margin: 0;
            color: #4A5568;
            font-size: 0.9rem;
        }

        .status-bar {
            background: #E2E8F0;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 16px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .instructions {
            background: #FFF5F5;
            border: 1px solid #FEB2B2;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }

        .instructions h4 {
            margin: 0 0 8px 0;
            color: #C53030;
        }

        .code-block {
            background: #1A202C;
            color: #E2E8F0;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 12px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .btn {
            background: #4299E1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
            margin: 4px;
        }

        .btn:hover {
            background: #3182CE;
        }

        .btn-secondary {
            background: #718096;
        }

        .btn-secondary:hover {
            background: #4A5568;
        }

        #firebase-multiplayer-container {
            margin: 24px 0;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .error {
            background: #FED7D7;
            color: #C53030;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 12px 0;
        }

        .success {
            background: #C6F6D5;
            color: #276749;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 12px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üî• Firebase Multiplayer Demo</h1>
            <p>–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è Firebase Realtime Database –¥–ª—è –º—É–ª—å—Ç–∏–ø–ª–µ—î—Ä –≥—Ä–∏</p>
        </header>

        <div class="demo-section">
            <h3>üöÄ –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ Firebase —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó</h3>
            <div class="features">
                <div class="feature">
                    <h4>üîÑ –†–µ–∞–ª—Ç–∞–π–º —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è</h4>
                    <p>–ú–∏—Ç—Ç—î–≤–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –º—ñ–∂ –≤—Å—ñ–º–∞ –≥—Ä–∞–≤—Ü—è–º–∏ —á–µ—Ä–µ–∑ Firebase Realtime Database</p>
                </div>
                <div class="feature">
                    <h4>üîê –ë–µ–∑–ø–µ–∫–∞</h4>
                    <p>–ó–∞—Ö–∏—â–µ–Ω—ñ Firebase Security Rules —Ç–∞ –∞–Ω–æ–Ω—ñ–º–Ω–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è</p>
                </div>
                <div class="feature">
                    <h4>üì± –û—Ñ–ª–∞–π–Ω –ø—ñ–¥—Ç—Ä–∏–º–∫–∞</h4>
                    <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—ñ –∑'—î–¥–Ω–∞–Ω–Ω—è</p>
                </div>
                <div class="feature">
                    <h4>üåç –ì–ª–æ–±–∞–ª—å–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å</h4>
                    <p>Firebase CDN –∑–∞–±–µ–∑–ø–µ—á—É—î —à–≤–∏–¥–∫–∏–π –¥–æ—Å—Ç—É–ø –ø–æ –≤—Å—å–æ–º—É —Å–≤—ñ—Ç—É</p>
                </div>
            </div>
        </div>

        <div class="instructions">
            <h4>‚ö†Ô∏è –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –ø–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—é</h4>
            <p>
                <strong>–î–ª—è —Ä–æ–±–æ—Ç–∏ –¥–µ–º–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ:</strong><br>
                1. –°—Ç–≤–æ—Ä–∏—Ç–∏ Firebase –ø—Ä–æ–µ–∫—Ç<br>
                2. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Realtime Database<br>
                3. –ó–∞–º—ñ–Ω–∏—Ç–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –≤ firebase-config.js<br>
                4. –î–æ–¥–∞—Ç–∏ Security Rules
            </p>
        </div>

        <div class="status-bar" id="status-bar">
            –°—Ç–∞—Ç—É—Å: –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Firebase...
        </div>

        <!-- Firebase Multiplayer UI –±—É–¥–µ –≤—Å—Ç–∞–≤–ª–µ–Ω–æ —Å—é–¥–∏ -->
        <div id="firebase-multiplayer-container"></div>

        <div class="demo-section">
            <h3>üìñ –¢–µ—Ö–Ω—ñ—á–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h3>
            <p><strong>–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞:</strong> Firebase Realtime Database + Anonymous Auth</p>
            <p><strong>–ü–µ—Ä–µ–≤–∞–≥–∏:</strong></p>
            <ul>
                <li>–ù–µ–º–∞—î –ø–æ—Ç—Ä–µ–±–∏ –≤ –≤–ª–∞—Å–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—ñ</li>
                <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è</li>
                <li>–í–±—É–¥–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–ø–µ–∫–∏</li>
                <li>–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º—É</li>
                <li>–†–µ–∞–ª—Ç–∞–π–º –æ–Ω–æ–≤–ª–µ–Ω–Ω—è</li>
            </ul>
            
            <h4>–ü—Ä–∏–∫–ª–∞–¥ Firebase Security Rules:</h4>
            <div class="code-block">
{
  "rules": {
    "rooms": {
      "$roomCode": {
        ".read": "auth != null",
        ".write": "auth != null && (!data.exists() || data.child('hostId').val() == auth.uid)",
        "players": {
          "$playerId": {
            ".write": "auth != null && $playerId == auth.uid"
          }
        }
      }
    }
  }
}
            </div>
        </div>

        <div class="demo-section">
            <h3>üéÆ –Ø–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏</h3>
            <ol>
                <li><strong>–°—Ç–≤–æ—Ä—ñ—Ç—å –∫—ñ–º–Ω–∞—Ç—É:</strong> –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–°—Ç–≤–æ—Ä–∏—Ç–∏ –∫—ñ–º–Ω–∞—Ç—É" —Ç–∞ –ø–æ–¥—ñ–ª—ñ—Ç—å—Å—è –∫–æ–¥–æ–º</li>
                <li><strong>–ü—Ä–∏—î–¥–Ω–∞–π—Ç–µ—Å—å:</strong> –í–≤–µ–¥—ñ—Ç—å –∫–æ–¥ –∫—ñ–º–Ω–∞—Ç–∏ –≤—ñ–¥ –¥—Ä—É–≥–∞</li>
                <li><strong>–ì—Ä–∞–π—Ç–µ:</strong> –Ø–∫ —Ç—ñ–ª—å–∫–∏ –∑'—è–≤–∏—Ç—å—Å—è 2 –≥—Ä–∞–≤—Ü—ñ, —Ö–æ—Å—Ç –º–æ–∂–µ –ø–æ—á–∞—Ç–∏ –≥—Ä—É</li>
            </ol>
        </div>

        <div style="text-align: center; margin-top: 32px;">
            <button class="btn" onclick="window.location.reload()">üîÑ –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>
            <button class="btn btn-secondary" onclick="clearLocalStorage()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –¥–∞–Ω—ñ</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <!-- Your Firebase scripts -->
    <script src="env-config.js"></script>
    <script src="firebase-config.js"></script>
    <script src="firebase-multiplayer.js"></script>
    <script src="firebase-multiplayer-ui.js"></script>

    <script>
        let statusUpdateInterval;
        
        function updateStatus() {
            const statusBar = document.getElementById('status-bar');
            if (!statusBar) return;

            if (typeof firebase === 'undefined') {
                statusBar.textContent = '–°—Ç–∞—Ç—É—Å: ‚ùå Firebase SDK –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ';
                statusBar.style.background = '#FED7D7';
                return;
            }

            if (window.firebaseMultiplayerManager) {
                const status = window.firebaseMultiplayerManager.getConnectionStatus();
                let statusText = '–°—Ç–∞—Ç—É—Å: ';
                
                if (status.initialized && status.connected) {
                    statusText += '‚úÖ Firebase –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ';
                    if (status.roomCode) {
                        statusText += ` | –ö—ñ–º–Ω–∞—Ç–∞: ${status.roomCode}`;
                    }
                    statusBar.style.background = '#C6F6D5';
                } else if (status.initialized) {
                    statusText += 'üîÑ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Firebase...';
                    statusBar.style.background = '#FEEBC8';
                } else {
                    statusText += '‚è≥ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Firebase...';
                    statusBar.style.background = '#E2E8F0';
                }
                
                statusBar.textContent = statusText;
            } else {
                statusBar.textContent = '–°—Ç–∞—Ç—É—Å: ‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤...';
                statusBar.style.background = '#E2E8F0';
            }
        }

        function clearLocalStorage() {
            localStorage.clear();
            alert('–õ–æ–∫–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ –æ—á–∏—â–µ–Ω–æ');
            window.location.reload();
        }

        // Update status every second
        statusUpdateInterval = setInterval(updateStatus, 1000);
        
        // Initial status update
        updateStatus();

        // Log Firebase events for debugging
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (window.firebaseMultiplayerManager) {
                    const manager = window.firebaseMultiplayerManager;
                    
                    // Log all events for debugging
                    ['initialized', 'roomCreated', 'roomJoined', 'roomLeft', 'playersUpdated', 
                     'gameStateUpdated', 'gameStarted', 'gameEnded', 'connectionStateChanged', 'error'].forEach(event => {
                        manager.on(event, (data) => {
                            console.log(`üî• Firebase Event [${event}]:`, data);
                        });
                    });
                }
            }, 2000);
        });
    </script>
</body>
</html>
