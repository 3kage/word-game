<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –≥–æ–ª–æ—Å–æ–≤–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="speech-styles.css">
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center">üé§ –¢–µ—Å—Ç –≥–æ–ª–æ—Å–æ–≤–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h2>
            
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium mb-2">–ú–æ–≤–∞ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è:</label>
                    <select id="language-select" class="w-full p-2 border rounded">
                        <option value="uk-UA">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
                        <option value="en-US">English</option>
                        <option value="ru-RU">–†—É—Å—Å–∫–∏–π</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">–ì–æ–ª–æ—Å:</label>
                    <select id="voice-select" class="w-full p-2 border rounded">
                        <option>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</option>
                    </select>
                </div>
            </div>
            
            <div class="grid grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium mb-2">–®–≤–∏–¥–∫—ñ—Å—Ç—å:</label>
                    <input type="range" id="rate-slider" min="0.5" max="2" step="0.1" value="1" class="w-full">
                    <span id="rate-value" class="text-sm text-gray-600">1.0</span>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">–¢–æ–Ω:</label>
                    <input type="range" id="pitch-slider" min="0" max="2" step="0.1" value="1" class="w-full">
                    <span id="pitch-value" class="text-sm text-gray-600">1.0</span>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-2">–ì—É—á–Ω—ñ—Å—Ç—å:</label>
                    <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="1" class="w-full">
                    <span id="volume-value" class="text-sm text-gray-600">1.0</span>
                </div>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">–°–∏–Ω—Ç–µ–∑ –º–æ–≤–∏ (Text-to-Speech)</h2>
            
            <textarea id="text-to-speak" class="w-full p-3 border rounded mb-4" rows="3" 
                      placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á—É–≤–∞–Ω–Ω—è...">–ü—Ä–∏–≤—ñ—Ç! –¶–µ —Ç–µ—Å—Ç –≥–æ–ª–æ—Å–æ–≤–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π –¥–ª—è –≥—Ä–∏ –≤ —Å–ª–æ–≤–∞.</textarea>
            
            <div class="flex gap-2">
                <button id="speak-btn" class="btn bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    üîä –û–∑–≤—É—á–∏—Ç–∏
                </button>
                <button id="stop-speech-btn" class="btn bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                    ‚èπÔ∏è –ó—É–ø–∏–Ω–∏—Ç–∏
                </button>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">–†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –º–æ–≤–∏ (Speech-to-Text)</h2>
            
            <div class="mb-4">
                <button id="listen-btn" class="btn bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    üé§ –ü–æ—á–∞—Ç–∏ —Å–ª—É—Ö–∞—Ç–∏
                </button>
                <span id="listening-status" class="ml-4 text-sm text-gray-600"></span>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium mb-2">–†–æ–∑–ø—ñ–∑–Ω–∞–Ω–∏–π —Ç–µ–∫—Å—Ç:</label>
                <textarea id="recognized-text" class="w-full p-3 border rounded bg-gray-50" rows="3" readonly></textarea>
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">–Ü–≥—Ä–æ–≤—ñ –∫–æ–º–∞–Ω–¥–∏</h2>
            
            <div class="grid grid-cols-2 gap-4 mb-4">
                <button id="demo-word-btn" class="btn bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    üì¢ –û–≥–æ–ª–æ—Å–∏—Ç–∏ —Å–ª–æ–≤–æ
                </button>
                <button id="demo-hint-btn" class="btn bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600">
                    üí° –î–∞—Ç–∏ –ø—ñ–¥–∫–∞–∑–∫—É
                </button>
                <button id="demo-score-btn" class="btn bg-teal-500 text-white px-4 py-2 rounded hover:bg-teal-600">
                    üéØ –û–≥–æ–ª–æ—Å–∏—Ç–∏ —Ä–∞—Ö—É–Ω–æ–∫
                </button>
                <button id="demo-time-btn" class="btn bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
                    ‚è∞ –ü–æ–ø–µ—Ä–µ–¥–∏—Ç–∏ –ø—Ä–æ —á–∞—Å
                </button>
            </div>
            
            <div class="text-sm text-gray-600 p-3 bg-gray-50 rounded">
                <strong>–ì–æ–ª–æ—Å–æ–≤—ñ –∫–æ–º–∞–Ω–¥–∏ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è:</strong><br>
                üî∏ "–ø—Ä–∞–≤–∏–ª—å–Ω–æ" / "correct" - –ø–æ–∑–Ω–∞—á–∏—Ç–∏ —è–∫ –ø—Ä–∞–≤–∏–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å<br>
                üî∏ "–ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏" / "skip" - –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ —Å–ª–æ–≤–æ<br>
                üî∏ "–ø—ñ–¥–∫–∞–∑–∫–∞" / "hint" - –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø—ñ–¥–∫–∞–∑–∫—É<br>
                üî∏ "–ø–æ–≤—Ç–æ—Ä–∏" / "repeat" - –ø–æ–≤—Ç–æ—Ä–∏—Ç–∏ —Å–ª–æ–≤–æ<br>
                üî∏ "—Å—Ç–æ–ø" / "stop" - –∑—É–ø–∏–Ω–∏—Ç–∏ –≥—Ä—É
            </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4">–ñ—É—Ä–Ω–∞–ª –ø–æ–¥—ñ–π</h2>
            <div id="event-log" class="bg-gray-50 p-3 rounded h-40 overflow-y-auto text-sm font-mono"></div>
            <button id="clear-log-btn" class="btn bg-gray-500 text-white px-3 py-1 rounded mt-2 text-sm">
                –û—á–∏—Å—Ç–∏—Ç–∏ –∂—É—Ä–Ω–∞–ª
            </button>
        </div>
    </div>

    <!-- Include speech functionality -->
    <script src="env-config.js"></script>
    <script src="localization.js"></script>
    <script src="speech.js"></script>
    
    <script>
        // Demo functionality
        let testSpeechManager = null;
        
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize speech manager
            testSpeechManager = new SpeechManager();
            await testSpeechManager.init();
            
            // Populate voice selector
            populateVoiceSelector();
            setupEventListeners();
            
            log('–¢–µ—Å—Ç –≥–æ–ª–æ—Å–æ–≤–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ');
        });
        
        function populateVoiceSelector() {
            const voiceSelect = document.getElementById('voice-select');
            const voices = testSpeechManager.getAvailableVoices();
            
            voiceSelect.innerHTML = '';
            voices.forEach(voice => {
                const option = document.createElement('option');
                option.value = voice.name;
                option.textContent = `${voice.name} (${voice.lang})`;
                voiceSelect.appendChild(option);
            });
        }
        
        function setupEventListeners() {
            // Language change
            document.getElementById('language-select').addEventListener('change', (e) => {
                testSpeechManager.language = e.target.value;
                if (testSpeechManager.recognition) {
                    testSpeechManager.recognition.lang = e.target.value;
                }
                log(`–ú–æ–≤—É –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞: ${e.target.value}`);
            });
            
            // Voice change
            document.getElementById('voice-select').addEventListener('change', (e) => {
                testSpeechManager.setVoice(e.target.value);
                log(`–ì–æ–ª–æ—Å –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞: ${e.target.value}`);
            });
            
            // Settings sliders
            document.getElementById('rate-slider').addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                testSpeechManager.settings.speechRate = value;
                document.getElementById('rate-value').textContent = value.toFixed(1);
            });
            
            document.getElementById('pitch-slider').addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                testSpeechManager.settings.speechPitch = value;
                document.getElementById('pitch-value').textContent = value.toFixed(1);
            });
            
            document.getElementById('volume-slider').addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                testSpeechManager.settings.speechVolume = value;
                document.getElementById('volume-value').textContent = value.toFixed(1);
            });
            
            // Text-to-Speech buttons
            document.getElementById('speak-btn').addEventListener('click', () => {
                const text = document.getElementById('text-to-speak').value;
                if (text.trim()) {
                    testSpeechManager.speak(text);
                    log(`–û–∑–≤—É—á—É–≤–∞–Ω–Ω—è: "${text}"`);
                }
            });
            
            document.getElementById('stop-speech-btn').addEventListener('click', () => {
                testSpeechManager.stopSpeaking();
                log('–û–∑–≤—É—á—É–≤–∞–Ω–Ω—è –∑—É–ø–∏–Ω–µ–Ω–æ');
            });
            
            // Speech-to-Text button
            document.getElementById('listen-btn').addEventListener('click', () => {
                if (testSpeechManager.isListening) {
                    testSpeechManager.stopListening();
                } else {
                    const started = testSpeechManager.startListening();
                    if (started) {
                        log('–ü–æ—á–∞—Ç–æ —Å–ª—É—Ö–∞–Ω–Ω—è...');
                    } else {
                        log('–ù–µ –≤–¥–∞–ª–æ—Å—è –ø–æ—á–∞—Ç–∏ —Å–ª—É—Ö–∞–Ω–Ω—è');
                    }
                }
            });
            
            // Demo buttons
            document.getElementById('demo-word-btn').addEventListener('click', () => {
                testSpeechManager.announceWord('–ö–û–¢–ò–ö');
            });
            
            document.getElementById('demo-hint-btn').addEventListener('click', () => {
                testSpeechManager.announceHint('–ü—ñ–¥–∫–∞–∑–∫–∞: –ø–µ—Ä—à–∞ –ª—ñ—Ç–µ—Ä–∞ "–ö", –≤—Å—å–æ–≥–æ 5 –ª—ñ—Ç–µ—Ä');
            });
            
            document.getElementById('demo-score-btn').addEventListener('click', () => {
                testSpeechManager.announceScore('15');
            });
            
            document.getElementById('demo-time-btn').addEventListener('click', () => {
                testSpeechManager.announceTimeWarning(10);
            });
            
            // Clear log
            document.getElementById('clear-log-btn').addEventListener('click', () => {
                document.getElementById('event-log').innerHTML = '';
            });
            
            // Speech events
            window.addEventListener('voiceCommand', (e) => {
                log(`–ì–æ–ª–æ—Å–æ–≤–∞ –∫–æ–º–∞–Ω–¥–∞: ${e.detail.action}`, 'green');
            });
            
            window.addEventListener('speechAnswer', (e) => {
                document.getElementById('recognized-text').value = e.detail.answer;
                log(`–†–æ–∑–ø—ñ–∑–Ω–∞–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: "${e.detail.answer}"`, 'blue');
            });
        }
        
        function log(message, color = 'black') {
            const eventLog = document.getElementById('event-log');
            const time = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.color = color;
            logEntry.textContent = `[${time}] ${message}`;
            eventLog.appendChild(logEntry);
            eventLog.scrollTop = eventLog.scrollHeight;
        }
        
        // Override speech manager event handlers for demo
        if (window.SpeechManager) {
            const originalInit = SpeechManager.prototype.init;
            SpeechManager.prototype.init = async function() {
                await originalInit.call(this);
                
                // Override event handlers for demo
                this.onListeningStart = () => {
                    document.getElementById('listening-status').textContent = 'üî¥ –°–ª—É—Ö–∞—é...';
                    document.getElementById('listen-btn').textContent = '‚èπÔ∏è –ó—É–ø–∏–Ω–∏—Ç–∏';
                    log('–ü–æ—á–∞—Ç–æ–∫ —Å–ª—É—Ö–∞–Ω–Ω—è', 'orange');
                };
                
                this.onListeningEnd = () => {
                    document.getElementById('listening-status').textContent = '';
                    document.getElementById('listen-btn').textContent = 'üé§ –ü–æ—á–∞—Ç–∏ —Å–ª—É—Ö–∞—Ç–∏';
                    log('–ö—ñ–Ω–µ—Ü—å —Å–ª—É—Ö–∞–Ω–Ω—è', 'orange');
                };
                
                this.onSpeechResult = (transcript) => {
                    log(`–†–æ–∑–ø—ñ–∑–Ω–∞–Ω–æ: "${transcript}"`, 'green');
                    
                    // Process as voice command
                    const command = this.processVoiceCommand(transcript);
                    
                    if (!command) {
                        // If not a command, treat as answer attempt
                        const event = new CustomEvent('speechAnswer', { detail: { answer: transcript } });
                        window.dispatchEvent(event);
                    }
                };
                
                this.onSpeechError = (error) => {
                    log(`–ü–æ–º–∏–ª–∫–∞ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è: ${error}`, 'red');
                };
                
                this.onSpeechStart = (text) => {
                    log(`–ü–æ—á–∞—Ç–æ–∫ –æ–∑–≤—É—á—É–≤–∞–Ω–Ω—è: "${text}"`, 'purple');
                };
                
                this.onSpeechEnd = (text) => {
                    log(`–ö—ñ–Ω–µ—Ü—å –æ–∑–≤—É—á—É–≤–∞–Ω–Ω—è: "${text}"`, 'purple');
                };
            };
        }
    </script>
</body>
</html>
