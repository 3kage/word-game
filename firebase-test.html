<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî• Firebase Test - word-bot-ua</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 32px;
        }

        .header h1 {
            margin: 0;
            color: #2D3748;
            font-size: 2rem;
            font-weight: 800;
        }

        .status {
            padding: 16px;
            border-radius: 8px;
            margin: 16px 0;
            font-weight: 600;
        }

        .status.success {
            background: #C6F6D5;
            color: #276749;
            border-left: 4px solid #38A169;
        }

        .status.error {
            background: #FED7D7;
            color: #C53030;
            border-left: 4px solid #E53E3E;
        }

        .status.info {
            background: #BEE3F8;
            color: #2B6CB0;
            border-left: 4px solid #3182CE;
        }

        .test-section {
            margin: 24px 0;
            padding: 20px;
            background: #F7FAFC;
            border-radius: 12px;
        }

        .test-section h3 {
            margin: 0 0 16px 0;
            color: #2D3748;
        }

        .btn {
            background: #4299E1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 4px;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #3182CE;
        }

        .btn:disabled {
            background: #A0AEC0;
            cursor: not-allowed;
        }

        .input {
            padding: 12px;
            border: 2px solid #E2E8F0;
            border-radius: 8px;
            width: 200px;
            margin: 8px;
        }

        .log {
            background: #1A202C;
            color: #E2E8F0;
            padding: 16px;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }

        #firebase-multiplayer-container {
            margin: 24px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üî• Firebase Test</h1>
            <p>–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è Firebase –¥–ª—è –ø—Ä–æ–µ–∫—Ç—É word-bot-ua</p>
        </header>

        <div id="status-container">
            <div id="firebase-status" class="status info">
                ‚è≥ –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Firebase...
            </div>
        </div>

        <div class="test-section">
            <h3>üîß –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è</h3>
            <div id="config-info">
                <p><strong>Project ID:</strong> word-bot-ua</p>
                <p><strong>Database URL:</strong> https://word-bot-ua-default-rtdb.europe-west1.firebasedatabase.app</p>
                <p><strong>Region:</strong> Europe West 1 (–ë–µ–ª—å–≥—ñ—è)</p>
            </div>
        </div>

        <div class="test-section">
            <h3>üß™ –¢–µ—Å—Ç–∏ –∑'—î–¥–Ω–∞–Ω–Ω—è</h3>
            <button id="test-connection" class="btn">–¢–µ—Å—Ç –∑'—î–¥–Ω–∞–Ω–Ω—è</button>
            <button id="test-auth" class="btn">–¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó</button>
            <button id="test-database" class="btn">–¢–µ—Å—Ç –±–∞–∑–∏ –¥–∞–Ω–∏—Ö</button>
        </div>

        <div class="test-section">
            <h3>üéÆ –¢–µ—Å—Ç –º—É–ª—å—Ç–∏–ø–ª–µ—î—Ä–∞</h3>
            <div>
                <input type="text" id="player-name" class="input" placeholder="–í–∞—à–µ —ñ–º'—è" value="–¢–µ—Å—Ç–µ—Ä">
                <button id="create-room" class="btn">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∫—ñ–º–Ω–∞—Ç—É</button>
            </div>
            <div>
                <input type="text" id="room-code" class="input" placeholder="–ö–æ–¥ –∫—ñ–º–Ω–∞—Ç–∏" maxlength="6">
                <button id="join-room" class="btn">–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è</button>
            </div>
            <div>
                <button id="leave-room" class="btn" disabled>–ü–æ–∫–∏–Ω—É—Ç–∏ –∫—ñ–º–Ω–∞—Ç—É</button>
            </div>
        </div>

        <!-- Firebase UI –±—É–¥–µ —Ç—É—Ç -->
        <div id="firebase-multiplayer-container"></div>

        <div class="test-section">
            <h3>üìã –õ–æ–≥ –ø–æ–¥—ñ–π</h3>
            <div id="log" class="log">Firebase test started...\n</div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <!-- Environment Config -->
    <script src="env-config.js"></script>

    <!-- Firebase Scripts -->
    <script src="firebase-config.js"></script>
    <script src="firebase-multiplayer.js"></script>
    <script src="firebase-multiplayer-ui.js"></script>

    <script>
        let firebaseManager = null;
        let currentRoom = null;

        function log(message) {
            const logEl = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('firebase-status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        async function testConnection() {
            try {
                log('Testing Firebase connection...');
                
                if (typeof firebase === 'undefined') {
                    throw new Error('Firebase SDK not loaded');
                }

                const config = FirebaseConfig.getConfig();
                log(`Using project: ${config.projectId}`);
                log(`Database URL: ${config.databaseURL}`);

                // Test database connection
                const connectedRef = firebase.database().ref('.info/connected');
                connectedRef.once('value', (snapshot) => {
                    if (snapshot.val() === true) {
                        log('‚úÖ Firebase database connection successful');
                        updateStatus('‚úÖ Firebase –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ', 'success');
                    } else {
                        log('‚ùå Firebase database connection failed');
                        updateStatus('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Firebase', 'error');
                    }
                });

            } catch (error) {
                log(`‚ùå Connection test failed: ${error.message}`);
                updateStatus(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}`, 'error');
            }
        }

        async function testAuth() {
            try {
                log('Testing Firebase authentication...');
                
                const auth = firebase.auth();
                const userCredential = await auth.signInAnonymously();
                
                log(`‚úÖ Anonymous auth successful: ${userCredential.user.uid}`);
                updateStatus('‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞', 'success');
                
            } catch (error) {
                log(`‚ùå Auth test failed: ${error.message}`);
                updateStatus(`‚ùå –ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó: ${error.message}`, 'error');
            }
        }

        async function testDatabase() {
            try {
                log('Testing database write/read...');
                
                const testRef = firebase.database().ref('test/connection');
                const testData = {
                    timestamp: Date.now(),
                    message: 'Firebase test successful'
                };
                
                await testRef.set(testData);
                log('‚úÖ Database write successful');
                
                const snapshot = await testRef.once('value');
                const data = snapshot.val();
                
                if (data && data.message === testData.message) {
                    log('‚úÖ Database read successful');
                    updateStatus('‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –ø—Ä–∞—Ü—é—î', 'success');
                } else {
                    throw new Error('Data verification failed');
                }
                
                // Clean up test data
                await testRef.remove();
                log('‚úÖ Test data cleaned up');
                
            } catch (error) {
                log(`‚ùå Database test failed: ${error.message}`);
                updateStatus(`‚ùå –ü–æ–º–∏–ª–∫–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö: ${error.message}`, 'error');
            }
        }

        async function createRoom() {
            try {
                if (!firebaseManager) {
                    firebaseManager = new FirebaseMultiplayerManager();
                    await new Promise(resolve => {
                        firebaseManager.on('initialized', resolve);
                    });
                }

                const playerName = document.getElementById('player-name').value || '–¢–µ—Å—Ç–µ—Ä';
                firebaseManager.setPlayerName(playerName);

                const roomCode = await firebaseManager.createRoom({
                    gameMode: 'test',
                    roundDuration: 60
                });

                currentRoom = roomCode;
                document.getElementById('room-code').value = roomCode;
                document.getElementById('leave-room').disabled = false;

                log(`‚úÖ Room created: ${roomCode}`);
                updateStatus(`‚úÖ –ö—ñ–º–Ω–∞—Ç—É —Å—Ç–≤–æ—Ä–µ–Ω–æ: ${roomCode}`, 'success');

            } catch (error) {
                log(`‚ùå Create room failed: ${error.message}`);
                updateStatus(`‚ùå –ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫—ñ–º–Ω–∞—Ç–∏: ${error.message}`, 'error');
            }
        }

        async function joinRoom() {
            try {
                const roomCode = document.getElementById('room-code').value.trim().toUpperCase();
                if (!roomCode) {
                    throw new Error('Enter room code');
                }

                if (!firebaseManager) {
                    firebaseManager = new FirebaseMultiplayerManager();
                    await new Promise(resolve => {
                        firebaseManager.on('initialized', resolve);
                    });
                }

                const playerName = document.getElementById('player-name').value || '–¢–µ—Å—Ç–µ—Ä';
                firebaseManager.setPlayerName(playerName);

                await firebaseManager.joinRoom(roomCode);
                
                currentRoom = roomCode;
                document.getElementById('leave-room').disabled = false;

                log(`‚úÖ Joined room: ${roomCode}`);
                updateStatus(`‚úÖ –ü—Ä–∏—î–¥–Ω–∞–ª–∏—Å—å –¥–æ –∫—ñ–º–Ω–∞—Ç–∏: ${roomCode}`, 'success');

            } catch (error) {
                log(`‚ùå Join room failed: ${error.message}`);
                updateStatus(`‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏—î–¥–Ω–∞–Ω–Ω—è: ${error.message}`, 'error');
            }
        }

        async function leaveRoom() {
            try {
                if (!firebaseManager || !currentRoom) return;

                await firebaseManager.leaveRoom();
                
                currentRoom = null;
                document.getElementById('room-code').value = '';
                document.getElementById('leave-room').disabled = true;

                log(`‚úÖ Left room`);
                updateStatus('‚úÖ –ü–æ–∫–∏–Ω—É–ª–∏ –∫—ñ–º–Ω–∞—Ç—É', 'success');

            } catch (error) {
                log(`‚ùå Leave room failed: ${error.message}`);
                updateStatus(`‚ùå –ü–æ–º–∏–ª–∫–∞ –≤–∏—Ö–æ–¥—É –∑ –∫—ñ–º–Ω–∞—Ç–∏: ${error.message}`, 'error');
            }
        }

        // Event listeners
        document.getElementById('test-connection').addEventListener('click', testConnection);
        document.getElementById('test-auth').addEventListener('click', testAuth);
        document.getElementById('test-database').addEventListener('click', testDatabase);
        document.getElementById('create-room').addEventListener('click', createRoom);
        document.getElementById('join-room').addEventListener('click', joinRoom);
        document.getElementById('leave-room').addEventListener('click', leaveRoom);

        // Auto test on load
        window.addEventListener('load', () => {
            log('Page loaded, starting auto tests...');
            
            setTimeout(() => {
                testConnection();
            }, 1000);

            setTimeout(() => {
                testAuth();
            }, 2000);

            setTimeout(() => {
                testDatabase();
            }, 3000);
        });

        // Firebase manager events
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof FirebaseMultiplayerManager !== 'undefined') {
                log('FirebaseMultiplayerManager available');
                
                // –ú–æ–∂–µ–º–æ —Å—Ç–≤–æ—Ä–∏—Ç–∏ UI
                if (typeof FirebaseMultiplayerUI !== 'undefined') {
                    log('Creating Firebase UI...');
                    setTimeout(() => {
                        new FirebaseMultiplayerUI();
                    }, 1000);
                }
            }
        });
    </script>
</body>
</html>
