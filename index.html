<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–≥–∞–¥–∞–π –°–ª–æ–≤–æ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
        }
        .card {
            background-color: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            width: 100%;
            max-width: 420px;
        }
        .btn {
            display: inline-block;
            font-weight: 600;
            padding: 12px 30px;
            border-radius: 50px;
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
        }
        .btn-primary {
            background-color: #4f46e5;
            color: white;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        .btn-secondary {
            background-color: #e5e7eb;
            color: #374151;
        }
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%234B5563%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 0.65em auto;
        }
        .word-display {
            word-wrap: break-word;
            word-break: break-word;
            hyphens: auto;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div id="main-container" class="w-full max-w-md mx-auto">

        <!-- Start Screen -->
        <div id="start-screen" class="card text-center">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">–í–≥–∞–¥–∞–π –°–ª–æ–≤–æ</h1>
            <p class="text-gray-600 mb-6">
                –ì—Ä–∞ –¥–ª—è –¥–≤–æ—Ö –≥—Ä–∞–≤—Ü—ñ–≤. –ü–æ —á–µ—Ä–∑—ñ –æ–ø–∏—Å—É–π—Ç–µ —Å–ª–æ–≤–∞ —Ç–∞ –≤—ñ–¥–≥–∞–¥—É–π—Ç–µ —ó—Ö, —â–æ–± –∑–∞—Ä–æ–±–∏—Ç–∏ –±–∞–ª–∏.
            </p>
            <div class="mb-8">
                <label for="dictionary-select" class="block mb-2 text-sm font-medium text-gray-700">–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é —Å–ª—ñ–≤:</label>
                <select id="dictionary-select" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5">
                </select>
            </div>
            <button id="start-button" class="btn btn-primary w-full text-lg">–ü–æ—á–∞—Ç–∏ –≥—Ä—É</button>
            <button id="history-button" class="btn btn-secondary w-full text-lg mt-3">–Ü—Å—Ç–æ—Ä—ñ—è —ñ–≥–æ—Ä</button>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="card hidden">
            <!-- Game content will be generated by JS -->
        </div>

        <!-- Round End Screen -->
        <div id="round-end-screen" class="card text-center hidden">
            <!-- Round end content will be generated by JS -->
        </div>

        <!-- Final End Screen -->
        <div id="end-screen" class="card text-center hidden">
            <!-- Final score content will be generated by JS -->
        </div>
        
        <!-- History Screen -->
        <div id="history-screen" class="card hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">–Ü—Å—Ç–æ—Ä—ñ—è —ñ–≥–æ—Ä</h2>
                <button id="close-history-button" class="text-gray-500 hover:text-gray-800 text-3xl leading-none">&times;</button>
            </div>
            <div id="history-list" class="space-y-3 max-h-96 overflow-y-auto">
                <!-- History items will be populated here -->
            </div>
        </div>

    </div>
    
    <script>
        // --- Word Dictionaries ---
        const wordDictionaries = {
          "–ó–∞–≥–∞–ª—å–Ω–∏–π": [
            '–°–æ–Ω—Ü–µ', '–ö–Ω–∏–≥–∞', '–ö–æ–º–ø\'—é—Ç–µ—Ä', '–í–æ–¥–∞', '–î–µ—Ä–µ–≤–æ', '–ú—ñ—Å—Ç', '–¢–µ–ª–µ—Ñ–æ–Ω', '–ú—É–∑–∏–∫–∞', '–ö–∞—Ä—Ç–∏–Ω–∞', '–ü–æ–¥–æ—Ä–æ–∂',
            '–•–º–∞—Ä–∞', '–ö–≤—ñ—Ç–∫–∞', '–ì–æ–¥–∏–Ω–Ω–∏–∫', '–ö–ª—é—á', '–î–æ—Ä–æ–≥–∞', '–õ—ñ—Ç–∞–∫', '–í–µ–ª–æ—Å–∏–ø–µ–¥', '–ì—ñ—Ç–∞—Ä–∞', '–û–∫–µ–∞–Ω', '–ì–æ—Ä–∞',
            '–ó—ñ—Ä–∫–∞', '–ú\'—è—á', '–°—Ç—ñ–ª', '–í—ñ–∫–Ω–æ', '–†—ñ—á–∫–∞', '–®–æ–∫–æ–ª–∞–¥', '–ö–∞–≤–∞', '–ú—Ä—ñ—è', '–°–º—ñ—Ö', '–î—Ä—É–∂–±–∞', '–õ—é–±–æ–≤',
            '–©–∞—Å—Ç—è', '–†–æ–¥–∏–Ω–∞', '–†–æ–±–æ—Ç–∞', '–°–≤—è—Ç–æ', '–õ—ñ—Ç–æ', '–ó–∏–º–∞', '–í–µ—Å–Ω–∞', '–û—Å—ñ–Ω—å', '–í–æ–∫–∑–∞–ª', '–¢–µ–∞—Ç—Ä', '–ö—ñ–Ω–æ',
            '–õ–∞–º–ø–∞', '–î–∑–µ—Ä–∫–∞–ª–æ', '–ü–æ–¥—É—à–∫–∞', '–ö–æ–≤–¥—Ä–∞', '–°—Ç—ñ–ª–µ—Ü—å', '–®–∞—Ñ–∞', '–¢–∞—Ä—ñ–ª–∫–∞', '–õ–æ–∂–∫–∞', '–í–∏–¥–µ–ª–∫–∞', '–ù—ñ–∂',
            '–°–Ω—ñ–¥–∞–Ω–æ–∫', '–û–±—ñ–¥', '–í–µ—á–µ—Ä—è', '–ü–∞—Ä–∫', '–õ—ñ—Å', '–ü–æ–ª–µ', '–û–∑–µ—Ä–æ', '–ú–æ—Ä–µ', '–ü–ª—è–∂', '–ö–æ—Ä–∞–±–µ–ª—å', '–ß–æ–≤–µ–Ω'
          ],
          "–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó": [
            '–°–º–∞—Ä—Ç—Ñ–æ–Ω', '–ù–æ—É—Ç–±—É–∫', '–ü—Ä–æ–≥—Ä–∞–º—ñ—Å—Ç', '–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç', '–ê–ª–≥–æ—Ä–∏—Ç–º', '–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö', '–°–µ—Ä–≤–µ—Ä', '–î—Ä–æ–Ω', '–†–æ–±–æ—Ç',
            '–í—ñ—Ä—Ç—É–∞–ª—å–Ω—ñ—Å—Ç—å', '–ë–ª–æ–∫—á–µ–π–Ω', '–ü—Ä–æ—Ü–µ—Å–æ—Ä', '–ö–ª–∞–≤—ñ–∞—Ç—É—Ä–∞', '–ú–æ–Ω—ñ—Ç–æ—Ä', '–®—Ç—É—á–Ω–∏–π —ñ–Ω—Ç–µ–ª–µ–∫—Ç', '–ú–µ—Ä–µ–∂–∞',
            '–î–æ–¥–∞—Ç–æ–∫', '–°–∞–π—Ç', '–•–º–∞—Ä–∞', '–ö–æ–¥', '–°–∫—Ä–∏–ø—Ç', '–§—Ä–µ–π–º–≤–æ—Ä–∫', '–ë—ñ–±–ª—ñ–æ—Ç–µ–∫–∞', '–ü—ñ–∫—Å–µ–ª—å', '–Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å',
            '–ì–∞–¥–∂–µ—Ç', '–ü–ª–∞–Ω—à–µ—Ç', '–ù–∞–≤—É—à–Ω–∏–∫–∏', '–ú—ñ–∫—Ä–æ—Ñ–æ–Ω', '–í–µ–±-–∫–∞–º–µ—Ä–∞', '–†–æ—É—Ç–µ—Ä', '–ú–æ–¥–µ–º', '–•–æ—Å—Ç–∏–Ω–≥', '–î–æ–º–µ–Ω'
          ],
          "–ü—Ä–∏—Ä–æ–¥–∞": [
            '–í–æ–¥–æ—Å–ø–∞–¥', '–ü—É—Å—Ç–µ–ª—è', '–í—É–ª–∫–∞–Ω', '–õ—å–æ–¥–æ–≤–∏–∫', '–î–∂—É–Ω–≥–ª—ñ', '–°–∞–≤–∞–Ω–∞', '–°–∫–µ–ª—è', '–°–≤—ñ—Ç–∞–Ω–æ–∫', '–ó–∞—Ö—ñ–¥ —Å–æ–Ω—Ü—è',
            '–°—É–∑—ñ—Ä\'—è', '–ö–æ–º–µ—Ç–∞', '–ê—Ç–º–æ—Å—Ñ–µ—Ä–∞', '–ï–∫–æ—Å–∏—Å—Ç–µ–º–∞', '–¢–æ—Ä–Ω–∞–¥–æ', '–û–∑–µ—Ä–æ', '–ü–æ–ª—è–Ω–∞', '–ö–æ–Ω—Ç–∏–Ω–µ–Ω—Ç', '–û—Å—Ç—Ä—ñ–≤',
            '–ü—ñ–≤–æ—Å—Ç—Ä—ñ–≤', '–ó–∞—Ç–æ–∫–∞', '–ü—Ä–æ—Ç–æ–∫–∞', '–ö–∞–Ω—å–π–æ–Ω', '–ü–µ—á–µ—Ä–∞', '–î–∂–µ—Ä–µ–ª–æ', '–ì–µ–π–∑–µ—Ä', '–ë–ª–∏—Å–∫–∞–≤–∫–∞', '–ì—Ä—ñ–º',
            '–í–µ—Å–µ–ª–∫–∞', '–¢—É–º–∞–Ω', '–†–æ—Å–∞', '–Ü–Ω—ñ–π', '–ü–∞–º–æ—Ä–æ–∑—å', '–•—É—Ä—Ç–æ–≤–∏–Ω–∞', '–ó–ª–∏–≤–∞', '–ì—Ä–∞–¥', '–ó–µ–º–ª–µ—Ç—Ä—É—Å'
          ],
          "–á–∂–∞ —Ç–∞ –Ω–∞–ø–æ—ó": [
            '–ü—ñ—Ü–∞', '–°—É—à—ñ', '–ë–æ—Ä—â', '–í–∞—Ä–µ–Ω–∏–∫–∏', '–ö—Ä—É–∞—Å–∞–Ω', '–ï—Å–ø—Ä–µ—Å–æ', '–õ–∏–º–æ–Ω–∞–¥', '–°–º—É–∑—ñ', '–ü–∞—Å—Ç–∞', '–°—Ç–µ–π–∫',
            '–°–∞–ª–∞—Ç', '–ú–æ—Ä–æ–∑–∏–≤–æ', '–¢—ñ—Ä–∞–º—ñ—Å—É', '–ö–æ–∫—Ç–µ–π–ª—å', '–°–∏—Ä–Ω–∏–∫', '–ú–ª–∏–Ω–µ—Ü—å', '–°—É–ø', '–ë—É—Ç–µ—Ä–±—Ä–æ–¥', '–°–µ–Ω–¥–≤—ñ—á',
            '–ô–æ–≥—É—Ä—Ç', '–ö–µ—Ñ—ñ—Ä', '–ú–æ–ª–æ–∫–æ', '–°—ñ–∫', '–ß–∞–π', '–ö–æ–º–ø–æ—Ç', '–£–∑–≤–∞—Ä', '–í–∏–Ω–æ', '–ü–∏–≤–æ', '–í—ñ—Å–∫—ñ', '–†–æ–º',
            '–¢–µ–∫—ñ–ª–∞', '–ì–æ—Ä—ñ–ª–∫–∞', '–î–∂–∏–Ω', '–•–ª—ñ–±', '–ë—É–±–ª–∏–∫', '–ë–∞–≥–µ—Ç', '–¢–æ—Ä—Ç', '–ü–∏—Ä—ñ–≥', '–ö–µ–∫—Å', '–ü–µ—á–∏–≤–æ'
          ],
          "–ü—Ä–æ—Ñ–µ—Å—ñ—ó": [
            '–õ—ñ–∫–∞—Ä', '–í—á–∏—Ç–µ–ª—å', '–Ü–Ω–∂–µ–Ω–µ—Ä', '–ê—Ä—Ö—ñ—Ç–µ–∫—Ç–æ—Ä', '–î–∏–∑–∞–π–Ω–µ—Ä', '–Æ—Ä–∏—Å—Ç', '–ë—É—Ö–≥–∞–ª—Ç–µ—Ä', '–ú–µ–Ω–µ–¥–∂–µ—Ä', '–ü—Ä–æ–¥–∞–≤–µ—Ü—å',
            '–í–æ–¥—ñ–π', '–ö—É—Ö–∞—Ä', '–ü–µ—Ä—É–∫–∞—Ä', '–§–µ—Ä–º–µ—Ä', '–ü–æ–∂–µ–∂–Ω–∏–∫', '–ü–æ–ª—ñ—Ü–µ–π—Å—å–∫–∏–π', '–í—ñ–π—Å—å–∫–æ–≤–∏–π', '–ñ—É—Ä–Ω–∞–ª—ñ—Å—Ç', '–ê–∫—Ç–æ—Ä',
            '–ú—É–∑–∏–∫–∞–Ω—Ç', '–•—É–¥–æ–∂–Ω–∏–∫', '–°–ø—ñ–≤–∞–∫', '–¢–∞–Ω—Ü—é—Ä–∏—Å—Ç', '–°–ø–æ—Ä—Ç—Å–º–µ–Ω', '–ù–∞—É–∫–æ–≤–µ—Ü—å', '–î–æ—Å–ª—ñ–¥–Ω–∏–∫', '–í–∏–Ω–∞—Ö—ñ–¥–Ω–∏–∫'
          ]
        };

        document.addEventListener('DOMContentLoaded', () => {
            const tg = window.Telegram.WebApp;
            tg.ready();

            const startScreen = document.getElementById('start-screen');
            const gameScreen = document.getElementById('game-screen');
            const roundEndScreen = document.getElementById('round-end-screen');
            const endScreen = document.getElementById('end-screen');
            const historyScreen = document.getElementById('history-screen');

            const startButton = document.getElementById('start-button');
            const historyButton = document.getElementById('history-button');
            const closeHistoryButton = document.getElementById('close-history-button');
            const dictionarySelect = document.getElementById('dictionary-select');
            const historyList = document.getElementById('history-list');

            let words = [];
            let availableWords = [];
            let player1Score = 0;
            let player2Score = 0;
            let currentRound = 0;
            const totalRounds = 2;
            let timer = 60;
            let timerInterval;

            function populateDictionaries() {
                dictionarySelect.innerHTML = '';
                const mixedOption = document.createElement('option');
                mixedOption.value = "–ó–º—ñ—à–∞–Ω–∏–π";
                mixedOption.textContent = "üé≤ –ó–º—ñ—à–∞–Ω–∏–π (–í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó)";
                dictionarySelect.appendChild(mixedOption);

                for (const category in wordDictionaries) {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    dictionarySelect.appendChild(option);
                }
            }
            
            function showScreen(screen) {
                [startScreen, gameScreen, roundEndScreen, endScreen, historyScreen].forEach(s => s.classList.add('hidden'));
                screen.classList.remove('hidden');
            }

            function resetAndExit() {
                clearInterval(timerInterval);
                showScreen(startScreen);
            }

            function startGame() {
                const selectedCategory = dictionarySelect.value;
                if (selectedCategory === "–ó–º—ñ—à–∞–Ω–∏–π") {
                    words = Object.values(wordDictionaries).flat();
                } else {
                    words = [...wordDictionaries[selectedCategory]];
                }
                
                player1Score = 0;
                player2Score = 0;
                currentRound = 0;
                startNextRound();
            }

            function startNextRound() {
                currentRound++;
                availableWords = [...words];
                
                gameScreen.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold text-gray-700">–†–∞—É–Ω–¥ ${currentRound}</h2>
                        <button id="exit-game-btn" class="text-sm font-semibold text-indigo-600 hover:text-indigo-800">–í–∏–π—Ç–∏</button>
                    </div>
                    <div class="flex justify-between items-center mb-4">
                        <div class="text-center">
                            <span class="text-sm text-gray-500">–ì—Ä–∞–≤–µ—Ü—å 1</span>
                            <p id="player1-score" class="text-3xl font-bold text-indigo-600">${player1Score}</p>
                        </div>
                        <div class="text-center">
                             <span class="text-sm text-gray-500">–ß–∞—Å</span>
                            <p id="timer" class="text-3xl font-bold text-red-500">60</p>
                        </div>
                        <div class="text-center">
                            <span class="text-sm text-gray-500">–ì—Ä–∞–≤–µ—Ü—å 2</span>
                            <p id="player2-score" class="text-3xl font-bold text-teal-600">${player2Score}</p>
                        </div>
                    </div>
                    <div id="turn-indicator" class="text-center bg-gray-100 p-2 rounded-lg mb-6 text-gray-700 font-semibold"></div>
                    <div class="text-center my-6 p-6 bg-indigo-50 rounded-lg min-h-[120px] flex items-center justify-center">
                        <h2 id="word-to-guess" class="text-3xl md:text-4xl font-bold text-gray-800 tracking-wider word-display">–°–õ–û–í–û</h2>
                    </div>
                    <div class="mt-6">
                         <div class="grid grid-cols-2 gap-4 mt-4">
                            <button id="correct-button" class="btn btn-primary bg-green-500 hover:bg-green-600">–ü—Ä–∞–≤–∏–ª—å–Ω–æ!</button>
                            <button id="skip-button" class="btn btn-secondary">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏</button>
                        </div>
                    </div>`;

                showScreen(gameScreen);
                
                document.getElementById('exit-game-btn').addEventListener('click', resetAndExit);
                document.getElementById('correct-button').addEventListener('click', handleCorrectGuess);
                document.getElementById('skip-button').addEventListener('click', nextWord);

                updateScores();
                nextWord();
                startTimer();
                updateTurnIndicator();
            }

            function updateTurnIndicator() {
                const turnIndicator = document.getElementById('turn-indicator');
                if (currentRound % 2 !== 0) {
                    turnIndicator.innerHTML = `<span>–û–ø–∏—Å—É—î: <b>–ì—Ä–∞–≤–µ—Ü—å 1</b></span> | <span>–í—ñ–¥–≥–∞–¥—É—î: <b>–ì—Ä–∞–≤–µ—Ü—å 2</b></span>`;
                } else {
                    turnIndicator.innerHTML = `<span>–û–ø–∏—Å—É—î: <b>–ì—Ä–∞–≤–µ—Ü—å 2</b></span> | <span>–í—ñ–¥–≥–∞–¥—É—î: <b>–ì—Ä–∞–≤–µ—Ü—å 1</b></span>`;
                }
            }

            function nextWord() {
                const wordToGuessDisplay = document.getElementById('word-to-guess');
                if (availableWords.length === 0) {
                    wordToGuessDisplay.textContent = "–°–ª–æ–≤–∞ —Å–∫—ñ–Ω—á–∏–ª–∏—Å—å!";
                    return;
                }
                const randomIndex = Math.floor(Math.random() * availableWords.length);
                wordToGuessDisplay.textContent = availableWords[randomIndex];
                availableWords.splice(randomIndex, 1);
            }
            
            function handleCorrectGuess() {
                if (currentRound % 2 !== 0) {
                    player1Score++;
                } else {
                    player2Score++;
                }
                updateScores();
                nextWord();
            }

            function updateScores() {
                document.getElementById('player1-score').textContent = player1Score;
                document.getElementById('player2-score').textContent = player2Score;
            }

            function startTimer() {
                timer = 60;
                const timerDisplay = document.getElementById('timer');
                timerDisplay.textContent = timer;
                clearInterval(timerInterval);
                timerInterval = setInterval(() => {
                    timer--;
                    timerDisplay.textContent = timer;
                    if (timer <= 0) {
                        endRound();
                    }
                }, 1000);
            }

            function endRound() {
                clearInterval(timerInterval);
                if (currentRound < totalRounds) {
                    roundEndScreen.innerHTML = `
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">–†–∞—É–Ω–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!</h2>
                        <p class="text-gray-600 mb-6">–ü–æ—Ç–æ—á–Ω–∏–π —Ä–∞—Ö—É–Ω–æ–∫:</p>
                        <div class="flex justify-around items-center mb-8">
                            <div class="text-center">
                                <span class="text-lg text-gray-500">–ì—Ä–∞–≤–µ—Ü—å 1</span>
                                <p class="text-5xl font-bold text-indigo-600">${player1Score}</p>
                            </div>
                            <div class="text-center">
                                <span class="text-lg text-gray-500">–ì—Ä–∞–≤–µ—Ü—å 2</span>
                                <p class="text-5xl font-bold text-teal-600">${player2Score}</p>
                            </div>
                        </div>
                        <p class="text-gray-600 mb-8">–î–∞–ª—ñ –æ–ø–∏—Å—É—î –ì—Ä–∞–≤–µ—Ü—å ${currentRound === 1 ? 2 : 1}.</p>
                        <button id="next-round-button" class="btn btn-primary w-full text-lg">–ü–æ—á–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —Ä–∞—É–Ω–¥</button>
                        <button id="reset-round-btn" class="btn btn-secondary w-full text-lg mt-3">–°–∫–∏–Ω—É—Ç–∏ —ñ –≤–∏–π—Ç–∏</button>`;
                    showScreen(roundEndScreen);
                    document.getElementById('next-round-button').addEventListener('click', startNextRound);
                    document.getElementById('reset-round-btn').addEventListener('click', resetAndExit);
                } else {
                    endGame();
                }
            }

            function endGame() {
                let winnerText = '';
                if (player1Score > player2Score) {
                    winnerText = 'üéâ –ü–µ—Ä–µ–º—ñ–≥ –ì—Ä–∞–≤–µ—Ü—å 1! üéâ';
                } else if (player2Score > player1Score) {
                    winnerText = 'üéâ –ü–µ—Ä–µ–º—ñ–≥ –ì—Ä–∞–≤–µ—Ü—å 2! üéâ';
                } else {
                    winnerText = 'ü§ù –ù—ñ—á–∏—è! ü§ù';
                }

                endScreen.innerHTML = `
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">–ì—Ä—É –∑–∞–≤–µ—Ä—à–µ–Ω–æ!</h2>
                    <p class="text-2xl font-semibold ${player1Score > player2Score ? 'text-indigo-600' : (player2Score > player1Score ? 'text-teal-600' : 'text-gray-600')} mb-6">${winnerText}</p>
                    <p class="text-gray-600 mb-4">–§—ñ–Ω–∞–ª—å–Ω–∏–π —Ä–∞—Ö—É–Ω–æ–∫:</p>
                    <div class="flex justify-around items-center mb-8">
                        <div class="text-center">
                            <span class="text-lg text-gray-500">–ì—Ä–∞–≤–µ—Ü—å 1</span>
                            <p class="text-5xl font-bold text-indigo-600">${player1Score}</p>
                        </div>
                        <div class="text-center">
                            <span class="text-lg text-gray-500">–ì—Ä–∞–≤–µ—Ü—å 2</span>
                            <p class="text-5xl font-bold text-teal-600">${player2Score}</p>
                        </div>
                    </div>
                    <button id="restart-button" class="btn btn-primary w-full text-lg">–ì—Ä–∞—Ç–∏ –∑–Ω–æ–≤—É</button>`;
                showScreen(endScreen);
                document.getElementById('restart-button').addEventListener('click', () => showScreen(startScreen));
                
                saveResult(winnerText);
            }

            function saveResult(winnerText) {
                const result = {
                    date: new Date().toISOString(),
                    p1Score: player1Score,
                    p2Score: player2Score,
                    winner: winnerText
                };

                tg.CloudStorage.getItem('word_game_history', (err, value) => {
                    if (err) {
                        console.error('Error getting history:', err);
                        return;
                    }
                    let history = value ? JSON.parse(value) : [];
                    history.push(result);
                    if (history.length > 10) {
                        history = history.slice(history.length - 10);
                    }
                    tg.CloudStorage.setItem('word_game_history', JSON.stringify(history), (err, success) => {
                        if (err) {
                            console.error('Error saving history:', err);
                        }
                    });
                });
            }

            function showHistory() {
                tg.CloudStorage.getItem('word_game_history', (err, value) => {
                    if (err) {
                        historyList.innerHTML = '<p class="text-red-500">–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é.</p>';
                        showScreen(historyScreen);
                        return;
                    }
                    
                    historyList.innerHTML = ''; 
                    const history = value ? JSON.parse(value) : [];

                    if (history.length === 0) {
                        historyList.innerHTML = '<p class="text-gray-500 text-center">–Ü—Å—Ç–æ—Ä—ñ—ó —ñ–≥–æ—Ä —â–µ –Ω–µ–º–∞—î.</p>';
                    } else {
                        history.reverse().forEach(game => {
                            const date = new Date(game.date).toLocaleString('uk-UA', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' });
                            const item = document.createElement('div');
                            item.className = 'bg-gray-50 p-4 rounded-lg';
                            item.innerHTML = `
                                <p class="font-semibold text-gray-700">${game.winner}</p>
                                <p class="text-sm text-gray-500">–†–∞—Ö—É–Ω–æ–∫: ${game.p1Score} - ${game.p2Score}</p>
                                <p class="text-xs text-gray-400 mt-1">${date}</p>
                            `;
                            historyList.appendChild(item);
                        });
                    }
                    showScreen(historyScreen);
                });
            }

            // Event Listeners
            populateDictionaries();
            startButton.addEventListener('click', startGame);
            historyButton.addEventListener('click', showHistory);
            closeHistoryButton.addEventListener('click', () => showScreen(startScreen));
        });
    </script>
</body>
</html>
